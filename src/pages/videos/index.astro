---
import Layout from '../../layouts/Layout.astro';
import VideoCard from '../../components/VideoCard.astro';
import fs from 'node:fs';
import path from 'node:path';

// Directory containing videos
const videosDir = path.join(process.cwd(), 'public', 'videos');
let videos: { filename: string; title: string; description: string }[] = [];

try {
  if (fs.existsSync(videosDir)) {
    videos = fs.readdirSync(videosDir)
      .filter(file => file.endsWith('.mp4'))
      .map(file => {
        const videoData: Record<string, { title: string; description: string }> = {
          "Dry Eye Causes and Treatment.mp4": {
            title: "Causas e Tratamentos do Olho Seco",
            description: "Entenda as principais causas da síndrome do olho seco e descubra as opções de tratamento mais eficazes disponíveis atualmente."
          },
          "E-EYE IRPL® - For the Treatment of Dry Eyes due to Meibomian Gland Dysfunction (MGD).mp4": {
            title: "Tratamento E-EYE IRPL® para DGM",
            description: "Conheça a tecnologia IRPL® e como ela trata eficazmente a disfunção das glândulas de Meibomius, uma das principais causas de olho seco."
          },
          "E-EYE treatment.mp4": {
            title: "Como funciona o tratamento E-Eye",
            description: "Veja passo a passo como o tratamento com E-Eye IRPL® é realizado e seus benefícios para a saúde ocular."
          },
          "E-Eye tratamento DGM.mp4": {
            title: "Tratamento DGM com E-Eye",
            description: "Demonstração completa do tratamento da disfunção das glândulas de Meibomius utilizando a tecnologia E-Eye IRPL®."
          },
          "Meibomian Gland Dysfunction - Dry Eye Treatment.mp4": {
            title: "Disfunção das Glândulas de Meibomius (DGM)",
            description: "Aprenda sobre a disfunção das glândulas de Meibomius, sua relação com o olho seco e as abordagens terapêuticas modernas."
          },
          "Meibomian Gland Dysfunction And Dry Eye (imr8ZOpU_a8).mp4": {
            title: "Entenda a Relação entre DGM e Olho Seco",
            description: "Explicação detalhada sobre como a disfunção das glândulas de Meibomius afeta a produção lacrimal e causa olho seco."
          },
          "Meibomian Gland Expression for MGD | The Dry Eye Clinic at Peter Ivins Eye Care.mp4": {
            title: "Expressão das Glândulas de Meibomius",
            description: "Técnica de expressão das glândulas de Meibomius para desobstrução e melhora da qualidade do filme lacrimal."
          },
          "Probing to Open Blocked Tear Ducts (lCj0RrBbzts).mp4": {
            title: "Sondagem das Vias Lacrimais",
            description: "Procedimento de sondagem para desobstrução das vias lacrimais, essencial para pacientes com epífora (excesso de lágrimas)."
          },
          "Punctal Plugs (878yyEfBVaM).mp4": {
            title: "Como funcionam os Plugs Lacrimais",
            description: "Entenda o funcionamento dos plugs lacrimais, pequenos dispositivos que ajudam a reter as lágrimas e aliviar os sintomas do olho seco."
          }
        };

        const videoInfo = videoData[file] || {
          title: file.replace(/\.mp4$/, '').replace(/\s*\([^)]+\)$/, ''),
          description: "Vídeo educativo sobre saúde ocular e tratamentos disponíveis."
        };
        
        return {
          filename: file,
          title: videoInfo.title,
          description: videoInfo.description
        };
      });
  }
} catch (e) {
  console.error("Error reading videos directory:", e);
}
---

<Layout 
  title="Vídeos | Olho Seco Caratinga"
  description="Assista a vídeos educativos sobre tratamento de olho seco e saúde ocular."
>
  <main class="pt-24">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-blue-900 to-blue-700 text-white py-20">
      <div class="container mx-auto px-6">
        <div class="max-w-4xl mx-auto text-center">
          <h1 class="text-4xl md:text-5xl font-bold mb-6">Vídeos Educativos</h1>
          <p class="text-xl text-blue-100">
            Aprenda mais sobre saúde ocular e tratamentos com nosso conteúdo audiovisual.
          </p>
        </div>
      </div>
    </section>

    <!-- Videos Grid -->
    <section class="py-20 bg-gray-50">
      <div class="container mx-auto px-6">
        {videos.length > 0 ? (
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {videos.map((video) => (
              <VideoCard 
                title={video.title} 
                description={video.description}
                src={`/videos/${video.filename}`}
                poster="/video-placeholder.svg"
              />
            ))}
          </div>
        ) : (
          <div class="text-center py-12">
            <p class="text-gray-500 text-lg">Nenhum vídeo disponível no momento.</p>
          </div>
        )}
      </div>
    </section>
  </main>
</Layout>
