---
import Layout from '../../layouts/Layout.astro';
import VideoCard from '../../components/VideoCard.astro';
import fs from 'node:fs';
import path from 'node:path';

// Directory containing videos
const videosDir = path.join(process.cwd(), 'public', 'videos');
let videos: { filename: string; title: string; description: string }[] = [];

try {
  if (fs.existsSync(videosDir)) {
    videos = fs.readdirSync(videosDir)
      .filter(file => file.endsWith('.mp4'))
      .map(file => {
        const videoData: Record<string, { title: string; description: string }> = {
          "Dry Eye Causes and Treatment.mp4": {
            title: "Causas e Tratamentos do Olho Seco",
            description: "Entenda as principais causas da síndrome do olho seco e descubra as opções de tratamento mais eficazes disponíveis atualmente."
          },
          "E-EYE IRPL® - For the Treatment of Dry Eyes due to Meibomian Gland Dysfunction (MGD).mp4": {
            title: "Tratamento E-EYE IRPL® para DGM",
            description: "Conheça a tecnologia IRPL® e como ela trata eficazmente a disfunção das glândulas de Meibomius, uma das principais causas de olho seco."
          },
          "E-EYE treatment.mp4": {
            title: "Como funciona o tratamento E-Eye",
            description: "Veja passo a passo como o tratamento com E-Eye IRPL® é realizado e seus benefícios para a saúde ocular."
          },
          "E-Eye tratamento DGM.mp4": {
            title: "Tratamento DGM com E-Eye",
            description: "Demonstração completa do tratamento da disfunção das glândulas de Meibomius utilizando a tecnologia E-Eye IRPL®."
          },
          "Meibomian Gland Dysfunction - Dry Eye Treatment.mp4": {
            title: "Disfunção das Glândulas de Meibomius (DGM)",
            description: "Aprenda sobre a disfunção das glândulas de Meibomius, sua relação com o olho seco e as abordagens terapêuticas modernas."
          },
          "Meibomian Gland Dysfunction And Dry Eye (imr8ZOpU_a8).mp4": {
            title: "Entenda a Relação entre DGM e Olho Seco",
            description: "Explicação detalhada sobre como a disfunção das glândulas de Meibomius afeta a produção lacrimal e causa olho seco."
          },
          "Meibomian Gland Expression for MGD | The Dry Eye Clinic at Peter Ivins Eye Care.mp4": {
            title: "Expressão das Glândulas de Meibomius",
            description: "Técnica de expressão das glândulas de Meibomius para desobstrução e melhora da qualidade do filme lacrimal."
          },
          "Probing to Open Blocked Tear Ducts (lCj0RrBbzts).mp4": {
            title: "Sondagem das Vias Lacrimais",
            description: "Procedimento de sondagem para desobstrução das vias lacrimais, essencial para pacientes com epífora (excesso de lágrimas)."
          },
          "Punctal Plugs (878yyEfBVaM).mp4": {
            title: "Como funcionam os Plugs Lacrimais",
            description: "Entenda o funcionamento dos plugs lacrimais, pequenos dispositivos que ajudam a reter as lágrimas e aliviar os sintomas do olho seco."
          }
        };

        const videoInfo = videoData[file] || {
          title: file.replace(/\.mp4$/, '').replace(/\s*\([^)]+\)$/, ''),
          description: "Vídeo educativo sobre saúde ocular e tratamentos disponíveis."
        };
        
        return {
          filename: file,
          title: videoInfo.title,
          description: videoInfo.description
        };
      });
  }
} catch (e) {
  console.error("Error reading videos directory:", e);
}
---

<Layout 
  title="Vídeos | Olho Seco Caratinga"
  description="Assista a vídeos educativos sobre tratamento de olho seco e saúde ocular."
>
  <main class="min-h-screen bg-[#020617]"> <!-- Dark Background for Cinema Feel -->
    
    <!-- Hero Section -->
    <section class="relative pt-32 pb-20 overflow-hidden">
        <!-- Background Glow effects -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-blue-900/20 blur-[120px] rounded-full pointer-events-none"></div>
        <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-blue-900/10 to-transparent pointer-events-none"></div>

      <div class="container mx-auto px-6 relative z-10 text-center">
          <span class="inline-block py-1 px-3 rounded-full bg-blue-900/50 border border-blue-700/50 text-blue-300 text-xs font-bold uppercase tracking-widest mb-6 backdrop-blur-sm">
            Portal Audiovisual
          </span>
          <h1 class="text-4xl md:text-6xl font-bold text-white mb-6 tracking-tight">
            Educação em <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">Alta Definição</span>
          </h1>
          <p class="text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed">
            Entenda seu diagnóstico e descubra como a tecnologia pode transformar sua saúde ocular.
          </p>
      </div>
    </section>

    <!-- Featured Video Section -->
    {videos.length > 0 && (
      <section class="pb-16">
        <div class="container mx-auto px-6">
            <div class="bg-[#0f172a] rounded-3xl p-1 border border-white/5 shadow-2xl shadow-blue-900/20 max-w-5xl mx-auto">
                <div class="bg-black rounded-[1.25rem] overflow-hidden relative aspect-video group">
                    <video
                        controls
                        class="w-full h-full object-cover"
                        poster="/video-placeholders/featured_cover.png" 
                    >
                        <source src={`/videos/${videos.find(v => v.filename.includes("E-EYE"))?.filename || videos[0].filename}`} type="video/mp4" />
                        Seu navegador não suporta vídeos.
                    </video>
                    <div class="absolute bottom-0 left-0 right-0 p-8 bg-gradient-to-t from-black/90 via-black/60 to-transparent pointer-events-none">
                        <span class="text-cyan-400 font-bold text-sm uppercase tracking-wide mb-2 block">Vídeo Destaque</span>
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">{videos.find(v => v.filename.includes("E-EYE"))?.title || videos[0].title}</h2>
                        <p class="text-gray-300 line-clamp-2 max-w-2xl">{videos.find(v => v.filename.includes("E-EYE"))?.description || videos[0].description}</p>
                    </div>
                </div>
            </div>
        </div>
      </section>
    )}

    <!-- Videos Grid -->
    <section class="py-20 bg-[#020617] border-t border-white/5">
      <div class="container mx-auto px-6">
        <div class="flex items-center justify-between mb-12">
            <h2 class="text-2xl font-bold text-white">Todos os Vídeos</h2>
            <div class="h-px bg-white/10 flex-1 ml-8"></div>
        </div>

        {videos.length > 0 ? (
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {videos.filter(v => v.filename !== (videos.find(v => v.filename.includes("E-EYE"))?.filename || videos[0].filename)).map((video) => (
              <VideoCard 
                title={video.title} 
                description={video.description}
                src={`/videos/${video.filename}`}
                poster="/video-placeholders/generic.png"
              />
            ))}
          </div>
        ) : (
          <div class="text-center py-24 bg-[#0f172a] rounded-3xl border border-dashed border-gray-800">
            <p class="text-gray-500 text-lg">Nenhum vídeo disponível no momento.</p>
          </div>
        )}
      </div>
    </section>

    <!-- Videos Grid -->
    <section class="py-20 bg-[#020617] border-t border-white/5">
      <div class="container mx-auto px-6">
        <div class="flex items-center justify-between mb-12">
            <h2 class="text-2xl font-bold text-white">Todos os Vídeos</h2>
            <div class="h-px bg-white/10 flex-1 ml-8"></div>
        </div>

        {videos.length > 0 ? (
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {videos.filter(v => !v.filename.includes("E-EYE")).map((video) => ( // Filter out featured? Or show all? Let's show all but maybe featured is distinct
              <VideoCard 
                title={video.title} 
                description={video.description}
                src={`/videos/${video.filename}`}
                poster="/video-placeholders/generic.png"
              />
            ))}
             {/* Add back the featured ones if filtered out, or just map all videos if duplicates are okay. 
                 Let's keep it simple and map ALL videos for now to ensure accessibility, 
                 or filter if the list is long. For now, showing all in grid is safer. 
             */}
          </div>
        ) : (
          <div class="text-center py-24 bg-[#0f172a] rounded-3xl border border-dashed border-gray-800">
            <p class="text-gray-500 text-lg">Nenhum vídeo disponível no momento.</p>
          </div>
        )}
      </div>
    </section>
  </main>
</Layout>
