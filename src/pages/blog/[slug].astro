---
export const prerender = false;

import Layout from '../../layouts/Layout.astro';
import { getPostBySlug } from '../../lib/wordpress';

const { slug } = Astro.params;
const post = await getPostBySlug(slug as string);

if (!post) {
  return Astro.redirect('/404');
}

// Enhance SEO props
const seoTitle = `${post.title.rendered} | Olho Seco Caratinga`;
const seoDesc = post.excerpt.rendered.replace(/<[^>]+>/g, '').slice(0, 160) + '...';
const featImage = post._embedded?.['wp:featuredmedia']?.[0]?.source_url;
---

<Layout title={seoTitle} description={seoDesc} image={featImage} type="article">
  <article class="bg-white min-h-screen pb-20">
    <!-- Hero / Featured Image -->
    {featImage ? (
      <div class="relative h-[60vh] w-full overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent z-10"></div>
        <img 
          src={featImage} 
          alt={post._embedded?.['wp:featuredmedia']?.[0]?.alt_text || post.title.rendered}
          class="w-full h-full object-cover"
        />
        <div class="absolute bottom-0 left-0 w-full z-20 p-6 md:p-12 text-white container mx-auto">
          <div class="max-w-4xl">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 leading-tight shadow-sm" set:html={post.title.rendered} />
            <div class="flex items-center space-x-4 text-sm md:text-base font-medium opacity-90">
              <span>{new Date(post.date).toLocaleDateString('pt-BR', { dateStyle: 'long' })}</span>
              {post._embedded?.author?.[0]?.name && (
                <>
                  <span>â€¢</span>
                  <span>Por {post._embedded.author[0].name}</span>
                </>
              )}
            </div>
          </div>
        </div>
      </div>
    ) : (
      <div class="bg-blue-900 py-32 text-white container mx-auto px-6">
        <div class="max-w-4xl mx-auto">
          <h1 class="text-4xl md:text-5xl font-bold mb-4" set:html={post.title.rendered} />
          <p class="opacity-80">
            {new Date(post.date).toLocaleDateString('pt-BR', { dateStyle: 'long' })}
          </p>
        </div>
      </div>
    )}

    <!-- Content -->
    <div class="container mx-auto px-6 mt-12">
      <div class="max-w-3xl mx-auto">
        <div class="wp-content text-lg text-gray-700 leading-relaxed space-y-6" set:html={post.content.rendered} />
        
        <div class="mt-16 pt-8 border-t border-gray-100 flex justify-between items-center">
          <a href="/blog" class="flex items-center text-blue-600 font-bold hover:text-blue-800 transition-colors group">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 transform group-hover:-translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Voltar para o Blog
          </a>
        </div>
      </div>
    </div>
  </article>
</Layout>

<style is:global>
  /* WordPress Content Styling */
  .wp-content h2 {
    font-size: 1.875rem;
    font-weight: 700;
    color: #1a202c;
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    line-height: 1.3;
  }
  
  .wp-content h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2d3748;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.3;
  }
  
  .wp-content p {
    margin-bottom: 1.5rem;
  }
  
  .wp-content ul {
    list-style-type: disc;
    padding-left: 1.5rem;
    margin-bottom: 1.5rem;
    color: #4a5568;
  }
  
  .wp-content ol {
    list-style-type: decimal;
    padding-left: 1.5rem;
    margin-bottom: 1.5rem;
    color: #4a5568;
  }
  
  .wp-content li {
    margin-bottom: 0.5rem;
  }
  
  .wp-content blockquote {
    border-left: 4px solid #3182ce;
    padding-left: 1.5rem;
    margin: 2rem 0;
    font-style: italic;
    color: #4a5568;
    background: #ebf8ff;
    padding: 1.5rem;
    border-radius: 0 0.5rem 0.5rem 0;
  }
  
  .wp-content img {
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    margin: 2rem auto;
    max-width: 100%;
    height: auto;
  }
  
  .wp-content figure {
    margin: 2rem 0;
  }
  
  .wp-content figcaption {
    font-size: 0.875rem;
    color: #718096;
    text-align: center;
    margin-top: 0.5rem;
  }

  .wp-content a {
    color: #3182ce;
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .wp-content a:hover {
    color: #2c5282;
  }
</style>
